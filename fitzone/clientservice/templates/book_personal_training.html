{% extends 'base.html' %}
{% load static %}

{% block title_name %}
FITZONE - Запись на тренировку
{% endblock %}

{% block content %}
<div class="personal-training-booking-page">
    <div class="booking-hero">
        <div class="hero-badge">
            <i class="fas fa-calendar-plus"></i>
            <span>Запись на тренировку</span>
        </div>
        <h1 class="hero-title">ПЕРСОНАЛЬНАЯ ТРЕНИРОВКА</h1>
        <p class="hero-description">Выберите удобное время для занятия с {{ trainer_profile.full_name }}</p>
    </div>

    <div class="container">
        <div class="booking-content">
            <!-- Основная информация -->
            <div class="booking-card">
                <div class="card-header">
                    <div class="class-icon">
                        <i class="fas fa-dumbbell"></i>
                    </div>
                    <h2 class="class-title">Личная тренировка</h2>
                </div>
                
                <div class="class-details">
                    <div class="detail-item highlight">
                        <div class="detail-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="detail-content">
                            <div class="detail-label">Тренер</div>
                            <div class="detail-value">{{ trainer_profile.full_name }}</div>
                        </div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="detail-content">
                            <div class="detail-label">Длительность</div>
                            <div class="detail-value">1 час</div>
                        </div>
                    </div>
                    
                    {% if has_active_package %}
                    <div class="detail-item highlight">
                        <div class="detail-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="detail-content">
                            <div class="detail-label">Оплата</div>
                            <div class="detail-value">Бесплатно (используется пакет)</div>
                            <div class="spots-warning">Осталось тренировок: {{ active_package.amount}}</div>
                        </div>
                    </div>
                    {% else %}
                    <div class="detail-item">
                        <div class="detail-icon">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="detail-content">
                            <div class="detail-label">Стоимость</div>
                            <div class="detail-value price">1 500 ₽</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="detail-item">
                        <div class="detail-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="detail-content">
                            <div class="detail-label">Формат</div>
                            <div class="detail-value">Индивидуальное занятие</div>
                        </div>
                    </div>
                </div>
                
                <div class="class-description">
                    <h3>О тренировке</h3>
                    <p>Персональная тренировка с профессиональным тренером. Индивидуальный подбор упражнений, контроль техники, работа над вашими конкретными целями. Идеально подходит для достижения максимальных результатов в кратчайшие сроки.</p>
                </div>
            </div>
            
            <!-- Боковая панель записи -->
            <div class="booking-sidebar">
                <div class="status-card {% if has_active_package %}success{% else %}warning{% endif %}">
                    <div class="status-icon">
                        {% if has_active_package %}
                        <i class="fas fa-gift"></i>
                        {% else %}
                        <i class="fas fa-credit-card"></i>
                        {% endif %}
                    </div>
                    <h3>
                        {% if has_active_package %}
                        Используется пакет тренировок
                        {% else %}
                        Оплата при записи
                        {% endif %}
                    </h3>
                    <p>
                        {% if has_active_package %}
                        Стоимость тренировки будет списана из вашего пакета
                        {% else %}
                        Стоимость тренировки: 1 500 рублей
                        {% endif %}
                    </p>
                </div>
                
                <div class="booking-form">
                    <div class="time-selection">
                        <h4>Выберите дату и время:</h4>
                        <div class="time-slots">
                            {% for slot in available_slots %}
                            <label class="time-slot">
                                <input type="radio" name="start_time" value="{{ slot.datetime|date:'c' }}" required>
                                <span class="slot-content">
                                    <span class="slot-date">{{ slot.datetime|date:"d.m.Y" }}</span>
                                    <span class="slot-time">{{ slot.datetime|date:"H:i" }}</span>
                                </span>
                            </label>
                            {% empty %}
                            <div class="no-slots">
                                <i class="fas fa-calendar-times"></i>
                                <p>Нет доступных слотов для записи</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
    {% if available_slots %}
    {% if has_active_package %}
    <!-- Если есть активный пакет - запись с использованием пакета -->
    <form method="post" action="{% url 'create_personal_training' trainer.id %}">
        {% csrf_token %}
        <input type="hidden" name="start_time" id="package_start_time">
        <input type="hidden" name="use_package" value="true">
        <button type="submit" class="btn btn-primary" id="package-booking-btn">
            <i class="fas fa-calendar-check"></i>
            Записаться (использовать пакет)
        </button>
    </form>
    {% else %}
    <!-- Если нет пакета - кнопка для открытия окна оплаты -->
    <button type="button" class="btn btn-primary" id="single-booking-btn">
        <i class="fas fa-calendar-check"></i>
        Записаться на тренировку - 1 500 ₽
    </button>
    {% endif %}
{% else %}
<button type="button" class="btn btn-secondary" disabled>
    <i class="fas fa-clock"></i>
    Нет доступных слотов
</button>
{% endif %}

<!-- Кнопка покупки пакета -->
{% if not has_active_package %}
<div class="package-purchase-section">
    <button type="button" id="open-package-modal" class="buy-package-btn">
        <i class="fas fa-shopping-cart"></i>
        Купить пакет тренировок
    </button>
    <div class="package-note">
        <i class="fas fa-info-circle"></i>
        <span>Пакет - это кредит тренировок. Вы покупаете тренировки сейчас, а записываетесь на них позже в удобное время.</span>
    </div>
</div>
{% endif %}
                
                <div class="booking-note">
                    <i class="fas fa-info-circle"></i>
                    <span>Вы можете отменить запись за 2 часа до начала тренировки</span>
                </div>
                
                <div class="info-card">
                    <h4>Что включено:</h4>
                    <ul>
                        <li><i class="fas fa-check"></i> Индивидуальная программа</li>
                        <li><i class="fas fa-check"></i> Контроль техники</li>
                        <li><i class="fas fa-check"></i> Рекомендации по питанию</li>
                        <li><i class="fas fa-check"></i> Прогресс отслеживание</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- СЕКЦИЯ ПЛАНА ТРЕНИРОВОК -->
        {% if training_plans %}
        <div class="training-plan-section">
            <div class="plan-header">
                <h2 class="plan-title">
                    <i class="fas fa-clipboard-list"></i>
                    Ваш план тренировок
                </h2>
                <p class="plan-subtitle">
                    Индивидуальная программа, разработанная тренером {{ trainer_profile.full_name }} специально для вас
                </p>
            </div>

            <div class="plans-grid">
                {% for plan in training_plans %}
                <div class="plan-card {% if plan.is_active %}active{% else %}completed{% endif %}">
                    <div class="plan-header-info">
                        <h3 class="plan-name">{{ plan.name }}</h3>
                        <span class="plan-status {% if plan.is_active %}active{% else %}completed{% endif %}">
                            {% if plan.is_active %}Активный{% else %}Завершен{% endif %}
                        </span>
                    </div>
                    
                    <div class="plan-description">
                        {{ plan.description|linebreaks }}
                    </div>
                    
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

    </div>
</div>
<!-- Модальное окно оплаты разовой тренировки -->
<div id="single-payment-modal" class="modal">
    <div class="modal-content payment-modal-content">
        <div class="modal-header">
            <h2>Оплата тренировки</h2>
            <button class="close-modal">&times;</button>
        </div>
        
        <div class="modal-body">
            <!-- Информация о тренировке -->
            <div class="class-info-summary">
                <div class="class-icon">
                    <i class="fas fa-dumbbell"></i>
                </div>
                <div class="class-details-summary">
                    <h3>Персональная тренировка</h3>
                    <p id="single-slot-details">Выберите время тренировки</p>
                    <p class="trainer-name">Тренер: {{ trainer_profile.full_name }}</p>
                </div>
                <div class="class-price">1 500 ₽</div>
            </div>

            <!-- Форма оплаты картой -->
            <form id="single-payment-form" class="payment-form">
                {% csrf_token %}
                <input type="hidden" name="start_time" id="single_start_time">
                <input type="hidden" name="amount" value="1">
                
                <!-- СЕКЦИЯ СОХРАНЕННЫХ КАРТ -->
                <div id="single-saved-cards-section" class="saved-cards-section" style="display: none;">
                    <h4>Сохраненные карты</h4>
                    <div id="single-saved-cards-list" class="saved-cards-list"></div>
                    <button type="button" id="single-use-new-card" class="use-new-card-btn">
                        <i class="fas fa-plus"></i>
                        Использовать новую карту
                    </button>
                </div>

                <!-- ФОРМА НОВОЙ КАРТЫ -->
                <div id="single-new-card-form" class="new-card-form">
                    <!-- Номер карты -->
                    <div class="form-group">
                        <label for="single_card_number">Номер карты *</label>
                        <div class="card-input-wrapper">
                            <input type="text" id="single_card_number" name="card_number" 
                                   maxlength="19" 
                                   placeholder="1234 5678 9012 3456" class="form-input" required>
                            <div class="card-icons">
                                <i class="fab fa-cc-visa"></i>
                                <i class="fab fa-cc-mastercard"></i>
                                <i class="fab fa-cc-mir"></i>
                            </div>
                        </div>
                        <div class="validation-message" id="single_card_number_error"></div>
                    </div>

                    <!-- Срок действия и CVV -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="single_expiry_date">Срок действия *</label>
                            <input type="text" id="single_expiry_date" name="expiry_date" 
                                   placeholder="ММ/ГГ" maxlength="5" class="form-input" required>
                            <div class="validation-message" id="single_expiry_date_error"></div>
                        </div>
                        <div class="form-group">
                            <label for="single_cvv">CVV/CVC *</label>
                            <input type="text" id="single_cvv" name="cvv" 
                                   placeholder="123" maxlength="3" class="form-input" required>
                            <div class="validation-message" id="single_cvv_error"></div>
                        </div>
                    </div>

                    <!-- Имя владельца карты -->
                    <div class="form-group">
                        <label for="single_card_holder">Имя владельца карты *</label>
                        <input type="text" id="single_card_holder" name="card_holder" 
                               placeholder="IVAN IVANOV" class="form-input" maxlength="50" required>
                        <div class="validation-message" id="single_card_holder_error"></div>
                    </div>

                    
                </div>

                <!-- Соглашения и кнопка оплаты -->
                <div class="agreements-section">
                    <label class="checkbox-label">
                        <input type="checkbox" id="single_agreement" required>
                        <span class="checkmark"></span>
                        Я соглашаюсь с <a href="/static/documents/clubrules.pdf"  target="_blank">правилами клуба</a> и 
                        <a href="/static/documents/personal.pdf" target="_blank">обработкой данных</a>
                    </label>
                </div>

                <button type="submit" id="single-pay-button" class="pay-button" disabled>
                    <i class="fas fa-lock"></i>
                    <span>Оплатить 1 500 ₽</span>
                </button>
            </form>
        </div>

        <div class="modal-footer">
            <div class="security-info">
                <div class="security-item">
                    <i class="fas fa-shield-alt"></i>
                    <span>Безопасная оплата</span>
                </div>
                <div class="security-item">
                    <i class="fas fa-lock"></i>
                    <span>SSL шифрование</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно покупки пакета с формой оплаты -->
<div id="package-payment-modal" class="modal">
    <div class="modal-content payment-modal-content">
        <div class="modal-header">
            <h2>Покупка пакета тренировок</h2>
            <button class="close-modal">&times;</button>
        </div>
        
        <div class="modal-body">
            <!-- Информация о пакете -->
            <div class="class-info-summary">
                <div class="class-icon">
                    <i class="fas fa-dumbbell"></i>
                </div>
                <div class="class-details-summary">
                    <h3>Пакет персональных тренировок</h3>
                    <p id="package-details">Выберите количество тренировок</p>
                    <p class="trainer-name">Тренер: {{ trainer_profile.full_name }}</p>
                </div>
                <div class="class-price" id="package-price">0 ₽</div>
            </div>

            <!-- Выбор количества тренировок -->
            <div class="package-selection">
                <h4>Выберите пакет:</h4>
                <div class="package-options">
                    <label class="package-option">
                        <input type="radio" name="package_amount" value="1" data-price="1500">
                        <div class="package-card">
                            <div class="package-count">1 тренировка</div>
                            <div class="package-price">1 500 ₽</div>
                        </div>
                    </label>
                    <label class="package-option">
                        <input type="radio" name="package_amount" value="3" data-price="4500">
                        <div class="package-card">
                            <div class="package-count">3 тренировки</div>
                            <div class="package-price">4 500 ₽</div>
                        </div>
                    </label>
                    <label class="package-option">
                        <input type="radio" name="package_amount" value="5" data-price="7500">
                        <div class="package-card">
                            <div class="package-count">5 тренировок</div>
                            <div class="package-price">7 500 ₽</div>
                        </div>
                    </label>
                    <label class="package-option">
                        <input type="radio" name="package_amount" value="10" data-price="15000">
                        <div class="package-card">
                            <div class="package-count">10 тренировок</div>
                            <div class="package-price">15 000 ₽</div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Форма оплаты картой -->
            <form id="package-payment-form" class="payment-form">
                {% csrf_token %}
                
                <div class="form-group">
                    <label for="package_card_number">Номер карты *</label>
                    <div class="card-input-wrapper">
                        <input type="text" id="package_card_number" name="card_number" 
                               maxlength="19" 
                               placeholder="0000 0000 0000 0000" class="form-input" required>
                        <div class="card-icons">
                            <i class="fab fa-cc-visa"></i>
                            <i class="fab fa-cc-mastercard"></i>
                            <i class="fab fa-cc-mir"></i>
                        </div>
                    </div>
                    <div class="validation-message" id="package_card_number_error"></div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="package_expiry_date">Срок действия *</label>
                        <input type="text" id="package_expiry_date" name="expiry_date" 
                               placeholder="ММ/ГГ" maxlength="5" class="form-input" required>
                        <div class="validation-message" id="package_expiry_date_error"></div>
                    </div>
                    <div class="form-group">
                        <label for="package_cvv">CVV/CVC *</label>
                        <input type="text" id="package_cvv" name="cvv" 
                               placeholder="000" maxlength="3" class="form-input" required>
                        <div class="validation-message" id="package_cvv_error"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="package_card_holder">Имя владельца карты *</label>
                    <input type="text" id="package_card_holder" name="card_holder" 
                           placeholder="IVAN IVANOV" class="form-input" maxlength="50" required>
                    <div class="validation-message" id="package_card_holder_error"></div>
                </div>

                

                <div class="agreements-section">
                    <label class="checkbox-label">
                        <input type="checkbox" id="package_agreement" required>
                        <span class="checkmark"></span>
                        Я соглашаюсь с <a href="/static/documents/clubrules.pdf" target="_blank">правилами клуба</a> и 
                        <a href="/static/documents/personal.pdf" target="_blank">обработкой данных</a>
                    </label>
                </div>

                <button type="submit" id="package-pay-button" class="pay-button" disabled>
                    <i class="fas fa-lock"></i>
                    <span id="package-pay-text">Оплатить 0 ₽</span>
                </button>
            </form>
        </div>

        <div class="modal-footer">
            <div class="security-info">
                <div class="security-item">
                    <i class="fas fa-shield-alt"></i>
                    <span>Безопасная оплата</span>
                </div>
                <div class="security-item">
                    <i class="fas fa-lock"></i>
                    <span>SSL шифрование</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно успешной оплаты -->
<div id="success-modal" class="modal">
    <div class="modal-content success-modal-content">
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h2 id="success-title">Успешно!</h2>
        <p id="success-message">Операция выполнена успешно.</p>
        <div class="order-details">
            <div class="detail-item">
                <span>Тренер:</span>
                <strong>{{ trainer_profile.full_name }}</strong>
            </div>
            <div class="detail-item">
                <span id="success-type-label">Тип:</span>
                <strong id="success-type-value">-</strong>
            </div>
            <div class="detail-item">
                <span>Сумма:</span>
                <strong id="success-price">0 ₽</strong>
            </div>
        </div>
        <div class="modal-actions">
            <button id="close-success-modal" class="btn-primary">Отлично!</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>

    :root {
    --light-card: #ffffff;
    --light-bg: #f8fafc;
    --light-border: #e2e8f0;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --accent-primary: #8b5cf6;
    --accent-secondary: #a78bfa;
    --accent-gradient: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
    --accent-light: rgba(139, 92, 246, 0.1);
}

.dark-theme {
    --light-card: #1e293b;
    --light-bg: #0f172a;
    --light-border: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --accent-primary: #8b5cf6;
    --accent-secondary: #a78bfa;
}
/* БЫЛО: */
.personal-training-booking-page .booking-hero {
    background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
    color: white;
    padding: 80px 0 60px;
    text-align: center;
    margin-bottom: 40px;
    margin-top: 80px;
}

/* СТАЛО: */
.personal-training-booking-page .booking-hero {
    background: transparent;
    color: var(--text-primary);
    padding: 60px 0 40px;
    text-align: center;
    margin-bottom: 40px;
    margin-top: 80px;
    border-bottom: 2px solid var(--light-border);
}

.dark-theme .personal-training-booking-page .booking-hero {
    border-bottom-color: var(--dark-border);
}

.personal-training-booking-page .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: var(--accent-primary);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    margin-bottom: 20px;
    font-weight: 600;
}

.personal-training-booking-page .hero-title {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 15px;
    color: var(--text-primary);
}

.personal-training-booking-page .hero-description {
    font-size: 1.2rem;
    color: var(--text-secondary);
    font-weight: 500;
    max-width: 600px;
    margin: 0 auto;
}

.personal-training-booking-page .booking-content {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 40px;
    max-width: 1200px;
    margin: 0 auto 60px;
    padding: 0 20px;
}

.personal-training-booking-page .booking-card {
    background: var(--light-card);
    border-radius: 20px;
    padding: 40px;
    border: 1px solid var(--light-border);
    box-shadow: var(--shadow-lg);
}

.dark-theme .personal-training-booking-page .booking-card {
    background: var(--dark-card);
    border-color: var(--dark-border);
}

.personal-training-booking-page .card-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--light-border);
}

.dark-theme .personal-training-booking-page .card-header {
    border-bottom-color: var(--dark-border);
}

.personal-training-booking-page .class-icon {
    width: 80px;
    height: 80px;
    background: var(--accent-gradient);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.personal-training-booking-page .class-icon i {
    color: white;
    font-size: 2rem;
}

.personal-training-booking-page .class-title {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--text-primary);
    margin: 0;
}

.personal-training-booking-page .class-details {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 30px;
}

.personal-training-booking-page .detail-item {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 15px;
    border-radius: 12px;
    background: var(--light-bg);
    transition: all 0.3s ease;
}

.dark-theme .personal-training-booking-page .detail-item {
    background: var(--dark-bg);
}

.personal-training-booking-page .detail-item:hover {
    transform: translateX(5px);
    box-shadow: var(--shadow-sm);
}

.personal-training-booking-page .detail-item.highlight {
    background: var(--accent-light);
    border-left: 4px solid var(--accent-primary);
}

.dark-theme .personal-training-booking-page .detail-item.highlight {
    background: rgba(74, 108, 247, 0.1);
}

.personal-training-booking-page .detail-icon {
    width: 50px;
    height: 50px;
    background: var(--light-card);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.dark-theme .personal-training-booking-page .detail-icon {
    background: var(--dark-bg);
}

.personal-training-booking-page .detail-icon i {
    color: var(--accent-primary);
    font-size: 1.2rem;
}

.personal-training-booking-page .detail-content {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.personal-training-booking-page .detail-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.personal-training-booking-page .detail-value {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
}

.personal-training-booking-page .detail-value.price {
    color: var(--accent-primary);
    font-size: 1.3rem;
}

.personal-training-booking-page .spots-warning {
    color: #ff6b6b;
    font-weight: 600;
    font-size: 0.9rem;
}

.personal-training-booking-page .class-description {
    padding-top: 20px;
    border-top: 2px solid var(--light-border);
}

.dark-theme .personal-training-booking-page .class-description {
    border-top-color: var(--dark-border);
}

.personal-training-booking-page .class-description h3 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 15px;
    color: var(--text-primary);
}

.personal-training-booking-page .class-description p {
    line-height: 1.6;
    color: var(--text-secondary);
    font-size: 1.1rem;
}

/* Sidebar Styles */
.personal-training-booking-page .booking-sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.personal-training-booking-page .status-card {
    background: var(--light-card);
    border-radius: 20px;
    padding: 30px;
    text-align: center;
    border: 1px solid var(--light-border);
    box-shadow: var(--shadow-lg);
}

.dark-theme .personal-training-booking-page .status-card {
    background: var(--dark-card);
    border-color: var(--dark-border);
}

.personal-training-booking-page .status-card.success {
    border-top: 4px solid #28a745;
}

.personal-training-booking-page .status-card.warning {
    border-top: 4px solid #ffc107;
}

.personal-training-booking-page .status-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    font-size: 2rem;
}

.personal-training-booking-page .status-card.success .status-icon {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
}

.personal-training-booking-page .status-card.warning .status-icon {
    background: rgba(255, 193, 7, 0.1);
    color: #ffc107;
}

.personal-training-booking-page .status-card h3 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 10px;
    color: var(--text-primary);
}

.personal-training-booking-page .status-card p {
    color: var(--text-secondary);
    margin-bottom: 20px;
    line-height: 1.5;
}

.personal-training-booking-page .booking-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.personal-training-booking-page .time-selection {
    margin-bottom: 25px;
}

.personal-training-booking-page .time-selection h4 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 15px;
    color: var(--text-primary);
}

.personal-training-booking-page .time-slots {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
    background: var(--light-bg);
    border-radius: 12px;
}

.dark-theme .personal-training-booking-page .time-slots {
    background: var(--dark-bg);
}

.personal-training-booking-page .time-slot {
    position: relative;
    cursor: pointer;
}

.personal-training-booking-page .time-slot input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
}

.personal-training-booking-page .slot-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px 10px;
    background: var(--light-card);
    border: 2px solid transparent;
    border-radius: 12px;
    transition: all 0.3s ease;
    text-align: center;
}

.dark-theme .personal-training-booking-page .slot-content {
    background: var(--dark-card);
}

.personal-training-booking-page .time-slot:hover .slot-content {
    border-color: var(--accent-primary);
    transform: translateY(-2px);
}

.personal-training-booking-page .time-slot input:checked + .slot-content,
.personal-training-booking-page .time-slot.active .slot-content {
    background: var(--accent-primary);
    color: white;
    border-color: var(--accent-primary);
}

.personal-training-booking-page .slot-date {
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 5px;
}

.personal-training-booking-page .slot-time {
    font-size: 1rem;
    font-weight: 700;
}

.personal-training-booking-page .no-slots {
    grid-column: 1 / -1;
    text-align: center;
    padding: 30px;
    color: var(--text-secondary);
}

.personal-training-booking-page .no-slots i {
    font-size: 2rem;
    margin-bottom: 10px;
    opacity: 0.5;
}

.personal-training-booking-page .btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 15px 25px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
}

.personal-training-booking-page .btn-primary {
    background: var(--accent-gradient);
    color: white;
    width: 100%;
    justify-content: center;
}

.personal-training-booking-page .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.personal-training-booking-page .btn-secondary {
    background: var(--light-bg);
    color: var(--text-primary);
    width: 100%;
    justify-content: center;
}

.dark-theme .personal-training-booking-page .btn-secondary {
    background: var(--dark-bg);
}

.personal-training-booking-page .btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

.personal-training-booking-page .booking-note {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 15px;
    padding: 15px;
    background: var(--light-bg);
    border-radius: 10px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.dark-theme .personal-training-booking-page .booking-note {
    background: var(--dark-bg);
}

.personal-training-booking-page .booking-note i {
    color: var(--accent-primary);
}

.personal-training-booking-page .info-card {
    background: var(--light-card);
    border-radius: 20px;
    padding: 25px;
    border: 1px solid var(--light-border);
}

.dark-theme .personal-training-booking-page .info-card {
    background: var(--dark-card);
    border-color: var(--dark-border);
}

.personal-training-booking-page .info-card h4 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 15px;
    color: var(--text-primary);
}

.personal-training-booking-page .info-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.personal-training-booking-page .info-card li {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 0;
    color: var(--text-secondary);
}

.personal-training-booking-page .info-card li i {
    color: var(--accent-primary);
    width: 20px;
    text-align: center;
}

/* Кнопка покупки пакета */
.buy-package-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 15px 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    margin-top: 10px;
}

.buy-package-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
}

/* Стили для секции плана тренировок */
.training-plan-section {
    margin: 60px auto;
    padding: 40px 20px;
    border-top: 1px solid var(--light-border);
    max-width: 1200px;
}

.dark-theme .training-plan-section {
    border-top-color: var(--dark-border);
}

.plan-header {
    text-align: center;
    margin-bottom: 40px;
}

.plan-title {
    font-size: 2rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.dark-theme .plan-title {
    color: var(--dark-text);
}

.plan-subtitle {
    color: var(--text-secondary);
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
}

.dark-theme .plan-subtitle {
    color: var(--dark-text-light);
}

.plans-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 30px;
}

.plan-card {
    background: var(--light-card);
    border-radius: 20px;
    padding: 30px;
    border: 1px solid var(--light-border);
    box-shadow: var(--shadow-medium);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.dark-theme .plan-card {
    background: var(--dark-card);
    border-color: var(--dark-border);
}

.plan-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-large);
}

.plan-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 5px;
    height: 100%;
    background: var(--accent-gradient);
}

.plan-card.active::before {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.plan-card.completed::before {
    background: linear-gradient(135deg, #6c757d 0%, #adb5bd 100%);
}

.plan-header-info {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
}

.plan-name {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
    flex: 1;
}

.dark-theme .plan-name {
    color: var(--dark-text);
}

.plan-status {
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-left: 15px;
}

.plan-status.active {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
    border: 1px solid rgba(40, 167, 69, 0.3);
}

.plan-status.completed {
    background: rgba(108, 117, 125, 0.1);
    color: #6c757d;
    border: 1px solid rgba(108, 117, 125, 0.3);
}

.plan-description {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 25px;
    font-size: 1rem;
}

.dark-theme .plan-description {
    color: var(--dark-text-light);
}

.plan-meta {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
    padding: 20px;
    background: var(--light-bg);
    border-radius: 12px;
}

.dark-theme .plan-meta {
    background: var(--dark-bg);
}

.plan-meta-item {
    display: flex;
    align-items: center;
    gap: 12px;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.dark-theme .plan-meta-item {
    color: var(--dark-text-light);
}

.plan-meta-item i {
    color: var(--accent-primary);
    width: 16px;
    text-align: center;
}

/* Стили для секции истории тренировок */
.training-history-section {
    margin: 60px auto;
    padding: 40px 20px;
    border-top: 1px solid var(--light-border);
    max-width: 1200px;
}

.dark-theme .training-history-section {
    border-top-color: var(--dark-border);
}

.history-header {
    text-align: center;
    margin-bottom: 40px;
}

.history-title {
    font-size: 2rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.dark-theme .history-title {
    color: var(--dark-text);
}

.history-subtitle {
    color: var(--text-secondary);
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
}

.dark-theme .history-subtitle {
    color: var(--dark-text-light);
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.history-item {
    display: flex;
    gap: 20px;
    padding: 25px;
    background: var(--light-card);
    border-radius: 15px;
    border: 1px solid var(--light-border);
    transition: all 0.3s ease;
}
/* Стили для сохраненных карт */
.saved-cards-section {
    margin-bottom: 20px;
}

.saved-cards-section h4 {
    margin-bottom: 15px;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.saved-cards-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
}

.saved-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
    background: var(--light-bg);
    border: 2px solid var(--light-border);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.dark-theme .saved-card {
    background: var(--dark-bg);
    border-color: var(--dark-border);
}

.saved-card:hover {
    border-color: var(--accent-primary);
    transform: translateY(-2px);
}

.saved-card.active {
    border-color: var(--accent-primary);
    background: var(--accent-light);
}

.dark-theme .saved-card.active {
    background: rgba(139, 92, 246, 0.1);
}

.card-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.card-icon {
    color: var(--accent-primary);
    font-size: 1.2rem;
}

.card-details span {
    display: block;
}

.card-number {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.card-expiry {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.delete-card-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
}

.delete-card-btn:hover {
    background: rgba(229, 62, 62, 0.1);
    color: #e53e3e;
}

.use-new-card-btn {
    width: 100%;
    padding: 12px;
    background: transparent;
    border: 2px dashed var(--light-border);
    border-radius: 10px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.dark-theme .use-new-card-btn {
    border-color: var(--dark-border);
}

.use-new-card-btn:hover {
    border-color: var(--accent-primary);
    color: var(--accent-primary);
}

.dark-theme .history-item {
    background: var(--dark-card);
    border-color: var(--dark-border);
}

.history-item:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-medium);
}

.history-item.completed {
    border-left: 4px solid #28a745;
}

.history-item.cancelled {
    border-left: 4px solid #dc3545;
}

.history-date {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-width: 80px;
    padding: 15px;
    background: var(--light-bg);
    border-radius: 10px;
    text-align: center;
}

.dark-theme .history-date {
    background: var(--dark-bg);
}

.history-day {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--accent-primary);
    line-height: 1;
}

.history-month {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
}

.history-content {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.history-main {
    flex: 1;
}

.history-type {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.dark-theme .history-type {
    color: var(--dark-text);
}

.history-time, .history-duration {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.dark-theme .history-time,
.dark-theme .history-duration {
    color: var(--dark-text-light);
}

.history-time i, .history-duration i {
    color: var(--accent-primary);
    width: 16px;
}

.history-status {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 10px;
}

.status-badge {
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-badge.completed {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
    border: 1px solid rgba(40, 167, 69, 0.3);
}

.status-badge.cancelled {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
    border: 1px solid rgba(220, 53, 69, 0.3);
}

.history-rating {
    display: flex;
    align-items: center;
    gap: 5px;
    color: #ffc107;
    font-weight: 600;
}

.no-history-message {
    text-align: center;
    padding: 60px 40px;
    color: var(--text-secondary);
}

.dark-theme .no-history-message {
    color: var(--dark-text-light);
}

.no-history-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.5;
    color: var(--accent-primary);
}

.no-history-message h3 {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: var(--text-primary);
}

.dark-theme .no-history-message h3 {
    color: var(--dark-text);
}

.no-history-message p {
    max-width: 500px;
    margin: 0 auto;
    line-height: 1.6;
}

/* Модальные окна */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.payment-modal-content {
    background: var(--light-card);
    border-radius: 20px;
    padding: 0;
    max-width: 500px;
    width: 95%;
    max-height: 90vh;
    overflow-y: auto;
    border: 1px solid var(--light-border);
    box-shadow: var(--shadow-lg);
}

.dark-theme .payment-modal-content {
    background: var(--dark-card);
    border-color: var(--dark-border);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 25px 30px;
    border-bottom: 1px solid var(--light-border);
}

.dark-theme .modal-header {
    border-bottom-color: var(--dark-border);
}

.modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    padding: 5px;
    border-radius: 5px;
}

.close-modal:hover {
    background: var(--light-bg);
    color: var(--text-primary);
}

.dark-theme .close-modal:hover {
    background: var(--dark-bg);
}

.modal-body {
    padding: 30px;
}

.class-info-summary {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: var(--light-bg);
    border-radius: 12px;
    margin-bottom: 25px;
}

.dark-theme .class-info-summary {
    background: var(--dark-bg);
}

.class-icon {
    width: 50px;
    height: 50px;
    background: var(--accent-gradient);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.class-icon i {
    color: white;
    font-size: 1.2rem;
}

.class-details-summary {
    flex: 1;
}

.class-details-summary h3 {
    margin: 0 0 5px 0;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
}

.class-details-summary p {
    margin: 2px 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.trainer-name {
    font-weight: 600;
    color: var(--accent-primary) !important;
}

.class-price {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--accent-primary);
}

/* Стили для выбора пакета */
.package-selection {
    margin-bottom: 25px;
}

.package-selection h4 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 15px;
    color: var(--text-primary);
}

.package-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
}

.package-option {
    position: relative;
    cursor: pointer;
}

.package-option input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
}

.package-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px 10px;
    background: var(--light-card);
    border: 2px solid transparent;
    border-radius: 12px;
    transition: all 0.3s ease;
    text-align: center;
}

.dark-theme .package-card {
    background: var(--dark-card);
}

.package-option:hover .package-card {
    border-color: var(--accent-primary);
    transform: translateY(-2px);
}

.package-option input:checked + .package-card {
    background: var(--accent-primary);
    color: white;
    border-color: var(--accent-primary);
}

.package-count {
    font-size: 0.9rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.package-price {
    font-size: 1rem;
    font-weight: 600;
}

.package-card small {
    font-size: 0.7rem;
    opacity: 0.8;
    margin-top: 5px;
}

/* Форма оплаты */
.payment-form {
    margin-top: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.form-input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid var(--light-border);
    border-radius: 8px;
    background: var(--light-bg);
    color: var(--text-primary);
    font-size: 1rem;
    transition: all 0.3s ease;
}

.dark-theme .form-input {
    background: var(--dark-bg);
    border-color: var(--dark-border);
    color: var(--text-primary);
}

.form-input:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
}

.card-input-wrapper {
    position: relative;
}

.card-icons {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    gap: 5px;
}

.card-icons i {
    color: var(--text-secondary);
    font-size: 1.2rem;
}

/* Сохранение карты */
.save-card-option {
    margin: 20px 0;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.checkbox-label input {
    display: none;
}

.checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid var(--light-border);
    border-radius: 4px;
    position: relative;
    transition: all 0.3s ease;
}

.dark-theme .checkmark {
    border-color: var(--dark-border);
}

.checkbox-label input:checked + .checkmark {
    background: var(--accent-primary);
    border-color: var(--accent-primary);
}

.checkbox-label input:checked + .checkmark::after {
    content: '✓';
    position: absolute;
    color: white;
    font-size: 12px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* Соглашения */
.agreements-section {
    margin: 20px 0;
}

.agreements-section .checkbox-label {
    margin-bottom: 10px;
}

.agreements-section a {
    color: var(--accent-primary);
    text-decoration: none;
}

.agreements-section a:hover {
    text-decoration: underline;
}

/* Кнопка оплаты */
.pay-button {
    width: 100%;
    padding: 15px;
    background: var(--accent-gradient);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.pay-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

.pay-button:not(:disabled):hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

/* Футер модального окна */
.modal-footer {
    padding: 20px 30px;
    border-top: 1px solid var(--light-border);
}

.dark-theme .modal-footer {
    border-top-color: var(--dark-border);
}

.security-info {
    display: flex;
    justify-content: center;
    gap: 20px;
}

.security-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.security-item i {
    color: var(--accent-primary);
}

/* Сообщения валидации */
.validation-message {
    display: none;
    color: #e53e3e;
    font-size: 0.8rem;
    margin-top: 5px;
}

.form-input.error {
    border-color: #e53e3e;
    box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1);
}

/* Модальное окно успеха */
.success-modal-content {
    background: var(--light-card);
    border-radius: 20px;
    padding: 30px;
    text-align: center;
    max-width: 400px;
    width: 95%;
    border: 1px solid var(--light-border);
    box-shadow: var(--shadow-lg);
}

.dark-theme .success-modal-content {
    background: var(--dark-card);
    border-color: var(--dark-border);
}

.success-icon {
    color: #4CAF50;
    font-size: 3rem;
    margin-bottom: 1rem;
}

.success-modal-content h2 {
    margin: 0 0 15px 0;
    color: var(--text-primary);
    font-size: 1.5rem;
}

.success-modal-content p {
    color: var(--text-secondary);
    margin-bottom: 20px;
}

.order-details {
    background: var(--light-bg);
    border-radius: 10px;
    padding: 15px;
    margin: 20px 0;
    text-align: left;
}

.dark-theme .order-details {
    background: var(--dark-bg);
}

.detail-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.detail-item:last-child {
    margin-bottom: 0;
}

.detail-item strong {
    color: var(--text-primary);
}

.modal-actions {
    margin-top: 20px;
}

.btn-primary {
    padding: 12px 30px;
    background: var(--accent-primary);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    background: var(--accent-secondary);
    transform: translateY(-2px);
}


/* Адаптивность */
@media (max-width: 1024px) {
    .personal-training-booking-page .booking-content {
        grid-template-columns: 1fr;
        gap: 30px;
    }
    
    .personal-training-booking-page .booking-sidebar {
        order: -1;
    }
    
    .plans-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .personal-training-booking-page .booking-hero {
        padding: 60px 0 40px;
        margin-top: 60px;
    }
    
    .personal-training-booking-page .hero-title {
        font-size: 2rem;
    }
    
    .personal-training-booking-page .hero-description {
        font-size: 1.1rem;
    }
    
    .personal-training-booking-page .booking-card {
        padding: 25px;
    }
    
    .personal-training-booking-page .card-header {
        flex-direction: column;
        text-align: center;
        gap: 15px;
    }
    
    .personal-training-booking-page .class-title {
        font-size: 1.6rem;
    }
    
    .personal-training-booking-page .detail-item {
        flex-direction: column;
        text-align: center;
        gap: 10px;
    }
    
    .personal-training-booking-page .time-slots {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }
    
    .plan-header-info {
        flex-direction: column;
        gap: 10px;
    }
    
    .plan-status {
        align-self: flex-start;
    }
    
    .plan-meta {
        grid-template-columns: 1fr;
    }
    
    .history-item {
        flex-direction: column;
        text-align: center;
    }
    
    .history-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .history-status {
        align-items: center;
    }
    
    .payment-modal-content {
        margin: 20px;
        width: calc(100% - 40px);
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .class-info-summary {
        flex-direction: column;
        text-align: center;
    }
    
    .security-info {
        flex-direction: column;
        gap: 10px;
    }
}

@media (max-width: 480px) {
    .plan-title,
    .history-title {
        font-size: 1.6rem;
    }
    
    .plan-card {
        padding: 20px;
    }
    
    .plans-grid {
        grid-template-columns: 1fr;
    }
    
    .personal-training-booking-page .hero-title {
        font-size: 1.8rem;
    }
}
.package-purchase-section {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--light-border);
}

.dark-theme .package-purchase-section {
    border-top-color: var(--dark-border);
}

.package-note {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
    padding: 12px;
    background: var(--light-bg);
    border-radius: 8px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.dark-theme .package-note {
    background: var(--dark-bg);
}

.package-note i {
    color: var(--accent-primary);
    flex-shrink: 0;
}


</style>
{% endblock %}

{% block skripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Элементы модальных окон
    const singlePaymentModal = document.getElementById('single-payment-modal');
    const packagePaymentModal = document.getElementById('package-payment-modal');
    const successModal = document.getElementById('success-modal');
    const closeModalBtns = document.querySelectorAll('.close-modal');
    const closeSuccessModalBtn = document.getElementById('close-success-modal');
    const openPackageBtn = document.getElementById('open-package-modal');
    const singleBookingBtn = document.getElementById('single-booking-btn');
    const packageBookingBtn = document.getElementById('package-booking-btn');
    
    // Элементы выбора пакета
    const packageOptions = document.querySelectorAll('input[name="package_amount"]');
    const packageDetails = document.getElementById('package-details');
    const packagePrice = document.getElementById('package-price');
    const packagePayText = document.getElementById('package-pay-text');
    
    // Элементы успешного окна
    const successTitle = document.getElementById('success-title');
    const successMessage = document.getElementById('success-message');
    const successTypeLabel = document.getElementById('success-type-label');
    const successTypeValue = document.getElementById('success-type-value');
    const successPrice = document.getElementById('success-price');

    // Поля формы оплаты
    // Поля формы оплаты
const cardFields = {
    single: [
        'single_card_number',
        'single_expiry_date', 
        'single_cvv',
        'single_card_holder'
    ],
    package: [
        'package_card_number',
        'package_expiry_date', 
        'package_cvv',
        'package_card_holder'
    ]
};

    // Функции для работы с модальными окнами
    function openSinglePaymentModal() {
        const selectedSlot = document.querySelector('input[name="start_time"]:checked');
        if (!selectedSlot) {
            alert('Пожалуйста, выберите время тренировки');
            return;
        }
        
        // Устанавливаем выбранное время в скрытое поле
        document.getElementById('single_start_time').value = selectedSlot.value;
        
        // Обновляем информацию о слоте
        const slotContent = selectedSlot.nextElementSibling;
        const date = slotContent.querySelector('.slot-date').textContent;
        const time = slotContent.querySelector('.slot-time').textContent;
        document.getElementById('single-slot-details').textContent = `${date}, ${time}`;
        
        singlePaymentModal.style.display = 'flex';
        validateSingleForm();
    }

    function openPackagePaymentModal() {
    // Сбрасываем выбор времени если был выбран
    const timeSlots = document.querySelectorAll('input[name="start_time"]');
    timeSlots.forEach(slot => {
        slot.checked = false;
        const content = slot.nextElementSibling;
        content.classList.remove('active');
    });
    
    packagePaymentModal.style.display = 'flex';
    validatePackageForm();
}

    function closeModals() {
        singlePaymentModal.style.display = 'none';
        packagePaymentModal.style.display = 'none';
        successModal.style.display = 'none';
        resetForms();
    }

    function openSuccessModal(type, amount, price) {
        closeModals();
        
        if (type === 'single') {
            successTitle.textContent = 'Запись прошла успешно!';
            successMessage.textContent = 'Вы записаны на тренировку. На ваш email отправлено подтверждение.';
            successTypeLabel.textContent = 'Дата и время:';
            successTypeValue.textContent = document.getElementById('single-slot-details').textContent;
        } else {
            successTitle.textContent = 'Пакет приобретен!';
            successMessage.textContent = 'Вы успешно приобрели пакет персональных тренировок.';
            successTypeLabel.textContent = 'Количество тренировок:';
            successTypeValue.textContent = amount;
        }
        
        successPrice.textContent = price.toLocaleString() + ' ₽';
        successModal.style.display = 'flex';
    }

    function closeSuccessModal() {
        successModal.style.display = 'none';
        // Обновляем страницу чтобы показать изменения
        window.location.reload();
    }

    // Обработчики событий
    if (singleBookingBtn) {
        singleBookingBtn.addEventListener('click', openSinglePaymentModal);
    }

    if (openPackageBtn) {
    openPackageBtn.addEventListener('click', function() {
        // Для покупки пакета НЕ нужно выбирать время
        openPackagePaymentModal();
    });
}

    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', closeModals);
    });

    if (closeSuccessModalBtn) {
        closeSuccessModalBtn.addEventListener('click', closeSuccessModal);
    }

    // Закрытие модальных окон при клике вне их
    window.addEventListener('click', function(event) {
        if (event.target === singlePaymentModal || event.target === packagePaymentModal || event.target === successModal) {
            closeModals();
        }
    });

    // Обработка выбора пакета
    packageOptions.forEach(option => {
        option.addEventListener('change', function() {
            const amount = this.value;
            const price = parseInt(this.dataset.price);
            
            packageDetails.textContent = `${amount} тренировка(ок)`;
            packagePrice.textContent = `${price.toLocaleString()} ₽`;
            packagePayText.textContent = `Оплатить ${price.toLocaleString()} ₽`;
            
            validatePackageForm();
        });
    });

    // Обработка записи с пакетом
    if (packageBookingBtn) {
    packageBookingBtn.addEventListener('click', function(e) {
        const selectedSlot = document.querySelector('input[name="start_time"]:checked');
        if (!selectedSlot) {
            e.preventDefault();
            alert('Пожалуйста, выберите время тренировки');
            return;
        }
        // Устанавливаем выбранное время в скрытое поле
        document.getElementById('package_start_time').value = selectedSlot.value;
        // Форма отправится автоматически
    });
}

    // Валидация полей формы
    function validateField(fieldId) {
        const field = document.getElementById(fieldId);
        const value = field.value.trim();
        const errorElement = document.getElementById(fieldId + '_error');
        
        let isValid = true;
        let errorMessage = '';

        switch(fieldId) {
            case 'single_card_number':
            case 'package_card_number':
                const cardDigits = value.replace(/\s/g, '');
                if (!/^\d{16}$/.test(cardDigits)) {
                    isValid = false;
                    errorMessage = 'Номер карты должен содержать 16 цифр';
                }
                break;

            case 'single_expiry_date':
            case 'package_expiry_date':
                if (!/^(0[1-9]|1[0-2])\/\d{2}$/.test(value)) {
                    isValid = false;
                    errorMessage = 'Формат: ММ/ГГ';
                } else {
                    // Проверка срока действия
                    const [month, year] = value.split('/');
                    const expiryDate = new Date(2000 + parseInt(year), parseInt(month) - 1);
                    const currentDate = new Date();
                    if (expiryDate < currentDate) {
                        isValid = false;
                        errorMessage = 'Срок действия карты истек';
                    }
                }
                break;

            case 'single_cvv':
            case 'package_cvv':
                if (!/^\d{3}$/.test(value)) {
                    isValid = false;
                    errorMessage = 'CVV должен содержать 3 цифры';
                }
                break;

            case 'single_card_holder':
            case 'package_card_holder':
                if (value.length < 2) {
                    isValid = false;
                    errorMessage = 'Введите имя и фамилию';
                }
                break;
        }

        if (errorElement) {
            if (!isValid) {
                errorElement.textContent = errorMessage;
                errorElement.style.display = 'block';
                field.classList.add('error');
            } else {
                errorElement.textContent = '';
                errorElement.style.display = 'none';
                field.classList.remove('error');
            }
        }

        return isValid;
    }

    // Валидация форм
    function validateSingleForm() {
        const agreementChecked = document.getElementById('single_agreement').checked;
        let allFieldsValid = true;
        
        for (const fieldId of cardFields.single) {
            const field = document.getElementById(fieldId);
            if (!field || !field.value.trim() || !validateField(fieldId)) {
                allFieldsValid = false;
                break;
            }
        }

        const payButton = document.getElementById('single-pay-button');
        if (allFieldsValid && agreementChecked) {
            payButton.disabled = false;
        } else {
            payButton.disabled = true;
        }
    }

    function validatePackageForm() {
        const packageSelected = document.querySelector('input[name="package_amount"]:checked');
        const agreementChecked = document.getElementById('package_agreement').checked;
        
        let allFieldsValid = false;
        
        if (packageSelected) {
            allFieldsValid = true;
            for (const fieldId of cardFields.package) {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim() || !validateField(fieldId)) {
                    allFieldsValid = false;
                    break;
                }
            }
        }

        const payButton = document.getElementById('package-pay-button');
        if (allFieldsValid && agreementChecked) {
            payButton.disabled = false;
        } else {
            payButton.disabled = true;
        }
    }

    function resetForms() {
        // Сбрасываем формы оплаты
        Object.values(cardFields).flat().forEach(fieldId => {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(fieldId + '_error');
            if (field) field.value = '';
            if (errorElement) {
                errorElement.textContent = '';
                errorElement.style.display = 'none';
                field.classList.remove('error');
            }
        });

        // Сбрасываем чекбоксы
        const singleAgreement = document.getElementById('single_agreement');
        const packageAgreement = document.getElementById('package_agreement');
        const singleSaveCard = document.getElementById('single_save_card');
        const saveCard = document.getElementById('save_card');
        
        if (singleAgreement) singleAgreement.checked = false;
        if (packageAgreement) packageAgreement.checked = false;
        if (singleSaveCard) singleSaveCard.checked = true;
        if (saveCard) saveCard.checked = true;

        // Сбрасываем выбор пакета
        packageOptions.forEach(option => option.checked = false);
        if (packageDetails) packageDetails.textContent = 'Выберите количество тренировок';
        if (packagePrice) packagePrice.textContent = '0 ₽';
        if (packagePayText) packagePayText.textContent = 'Оплатить 0 ₽';

        validateSingleForm();
        validatePackageForm();
    }

    // Обработка соглашений
    const singleAgreement = document.getElementById('single_agreement');
    const packageAgreement = document.getElementById('package_agreement');
    
    if (singleAgreement) {
        singleAgreement.addEventListener('change', validateSingleForm);
    }
    if (packageAgreement) {
        packageAgreement.addEventListener('change', validatePackageForm);
    }

    // Добавляем обработчики событий на поля карты
    Object.values(cardFields).flat().forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            field.addEventListener('input', function() {
                validateField(fieldId);
                if (fieldId.startsWith('single')) {
                    validateSingleForm();
                } else {
                    validatePackageForm();
                }
            });
            field.addEventListener('blur', function() {
                validateField(fieldId);
            });
        }
    });

    // Форматирование полей ввода
    function setupCardFieldFormatting(fieldId) {
        const field = document.getElementById(fieldId);
        if (!field) return;

        if (fieldId.includes('card_number')) {
            field.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                let formattedValue = '';
                
                for (let i = 0; i < value.length; i++) {
                    if (i > 0 && i % 4 === 0) {
                        formattedValue += ' ';
                    }
                    formattedValue += value[i];
                }
                
                e.target.value = formattedValue.substring(0, 19);
                validateField(fieldId);
                if (fieldId.startsWith('single')) {
                    validateSingleForm();
                } else {
                    validatePackageForm();
                }
            });
        } else if (fieldId.includes('expiry_date')) {
            field.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value.substring(0, 5);
                validateField(fieldId);
                if (fieldId.startsWith('single')) {
                    validateSingleForm();
                } else {
                    validatePackageForm();
                }
            });
        } else if (fieldId.includes('card_holder')) {
            field.addEventListener('input', function(e) {
                this.value = this.value.toUpperCase();
                validateField(fieldId);
                if (fieldId.startsWith('single')) {
                    validateSingleForm();
                } else {
                    validatePackageForm();
                }
            });
        } else if (fieldId.includes('cvv')) {
            field.addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '').substring(0, 3);
                validateField(fieldId);
                if (fieldId.startsWith('single')) {
                    validateSingleForm();
                } else {
                    validatePackageForm();
                }
            });
        }
    }

    // Применяем форматирование ко всем полям карты
    Object.values(cardFields).flat().forEach(fieldId => {
        setupCardFieldFormatting(fieldId);
    });

    // Обработка отправки форм
    const singlePaymentForm = document.getElementById('single-payment-form');
    const packagePaymentForm = document.getElementById('package-payment-form');

    // Обработка разовой тренировки
if (singlePaymentForm) {
    singlePaymentForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const payButton = document.getElementById('single-pay-button');
        
        if (!payButton.disabled) {
            // Показываем индикатор загрузки
            payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Обработка платежа...</span>';
            payButton.disabled = true;
            
            try {
                const startTime = document.getElementById('single_start_time').value;
                
                // Отправляем AJAX запрос в process_personal_payment (С временем)
                const response = await fetch("{% url 'process_personal_payment' trainer.id %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        start_time: startTime,
                        amount: 1,
                        price: 1500
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Показываем успешное сообщение
                    openSuccessModal('single', 1, 1500);
                } else {
                    alert(result.message);
                    // Возвращаем кнопку в исходное состояние
                    payButton.innerHTML = '<i class="fas fa-lock"></i><span>Оплатить 1 500 ₽</span>';
                    payButton.disabled = false;
                }
                
            } catch (error) {
                console.error('Ошибка:', error);
                alert('Произошла ошибка при обработке платежа: ' + error.message);
                // Возвращаем кнопку в исходное состояние
                payButton.innerHTML = '<i class="fas fa-lock"></i><span>Оплатить 1 500 ₽</span>';
                payButton.disabled = false;
            }
        }
    });
}

// Обработка покупки пакета
if (packagePaymentForm) {
    packagePaymentForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const packageSelected = document.querySelector('input[name="package_amount"]:checked');
        const payButton = document.getElementById('package-pay-button');
        
        if (!payButton.disabled && packageSelected) {
            // Показываем индикатор загрузки
            payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Обработка платежа...</span>';
            payButton.disabled = true;
            
            try {
                const amount = packageSelected.value;
                const price = parseInt(packageSelected.dataset.price);
                
                // Отправляем AJAX запрос в buy_personal_package (БЕЗ времени)
                const response = await fetch("{% url 'buy_personal_package' trainer.id %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        amount: amount,
                        price: price
                        // НЕ передаем start_time для пакета
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Показываем успешное сообщение
                    openSuccessModal('package', amount, price);
                } else {
                    alert(result.message);
                    // Возвращаем кнопку в исходное состояние
                    payButton.innerHTML = '<i class="fas fa-lock"></i><span>Оплатить ' + price.toLocaleString() + ' ₽</span>';
                    payButton.disabled = false;
                }
                
            } catch (error) {
                console.error('Ошибка:', error);
                alert('Произошла ошибка при обработке платежа: ' + error.message);
                // Возвращаем кнопку в исходное состояние
                const packageSelected = document.querySelector('input[name="package_amount"]:checked');
                if (packageSelected) {
                    payButton.innerHTML = '<i class="fas fa-lock"></i><span>Оплатить ' + parseInt(packageSelected.dataset.price).toLocaleString() + ' ₽</span>';
                }
                payButton.disabled = false;
            }
        }
    });
}

    // Функция для получения CSRF токена
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Инициализация
    validateSingleForm();
    validatePackageForm();

    // Добавляем обработчики для выбора времени
    const timeSlots = document.querySelectorAll('input[name="start_time"]');
    timeSlots.forEach(slot => {
        slot.addEventListener('change', function() {
            // Обновляем активный класс для визуального выделения
            timeSlots.forEach(s => {
                const content = s.nextElementSibling;
                if (s.checked) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        });
    });

    // Инициализируем активное состояние для уже выбранного слота
    const initialSelectedSlot = document.querySelector('input[name="start_time"]:checked');
    if (initialSelectedSlot) {
        initialSelectedSlot.nextElementSibling.classList.add('active');
    }

    // Добавляем обработчики для выбора пакета
    packageOptions.forEach(option => {
        option.addEventListener('change', function() {
            // Обновляем активный класс для визуального выделения
            packageOptions.forEach(o => {
                const card = o.nextElementSibling;
                if (o.checked) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
        });
    });

    // Инициализируем активное состояние для уже выбранного пакета
    const initialSelectedPackage = document.querySelector('input[name="package_amount"]:checked');
    if (initialSelectedPackage) {
        initialSelectedPackage.nextElementSibling.classList.add('active');
    }

    // Добавляем обработку Escape для закрытия модальных окон
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeModals();
        }
    });

    // Плавная прокрутка для временных слотов
    const timeSlotsContainer = document.querySelector('.time-slots');
    if (timeSlotsContainer) {
        timeSlotsContainer.addEventListener('wheel', function(e) {
            e.preventDefault();
            this.scrollLeft += e.deltaY;
        });
    }

    console.log('Personal training booking page initialized successfully');
});


</script>
{% endblock %}